<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/custom_style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <script src="https://dss.cloud/fa/js/all.min.js"></script>
    <link rel="stylesheet" type="text/css"  href="./assets/css/custom_style.css">
    <title>GGD Dashboard</title>
    <script src="assets/js/libs/modernizr-2.0.6.min.js"></script>
    <script src="assets/js/libs/d3.min.js"></script>
    <script src="assets/js/libs/crossfilter.min.js"></script>
    <script>
        var size_values = [100, 500, 1000, 2000, 0];
        var time_values = [];
        var today = new Date().getFullYear();
        for(var i = 0; i < 18; i++ ){
            time_values.push(today - i);
        }
        var categories = ["keywords", "geo", "population", "type", "level", "size", "department", "time"];
        var tagsInCategories = []; 
        var editMode = false;
        // Toggle edit mode by making input fields Editable and showing relevant fields
        function toggleEdit() {
            if (!editMode) {
                document.getElementById("edit-top-bar").style.display = "block";
                document.getElementById("title-input").contentEditable = true;
                document.getElementById("contact-input").contentEditable = true;
                document.getElementById("description-input").contentEditable = true;
                document.getElementById("keywords-input").contentEditable = true;

                //show case input fields
                document.getElementById("caseGraph").style.display = "none";
                document.getElementById("caseInput").style.display = "block";


                //blurs all geo levels
                var buttons = document.getElementsByClassName('geolevel');
                for (var i = 0; i < buttons.length; i++) {
                    console.log(buttons[i].style.opacity);
                    buttons[i].classList.add("faded")
                }

                $('.geoLevel').click(function(e) {
                    $(this).toggleClass('faded'); //you can list several class names 
                    e.preventDefault();
                });

                editMode = true;

            } else if (editMode) {
                document.getElementById("edit-top-bar").style.display = "none";
                document.getElementById("title-input").contentEditable = false;
                document.getElementById("contact-input").contentEditable = false;
                document.getElementById("description-input").contentEditable = false;
                document.getElementById("keywords-input").contentEditable = false;

                //hide case input fields
                document.getElementById("caseGraph").style.display = "block";
                document.getElementById("caseInput").style.display = "none";
                editMode = false;

            }

        }

        function changeView(view, c = false) {
            if (c) {
                $(c).toggle();
                toggleEye(view);
            } else {
                for (category in categories) {
                    cat = categories[category];
                    if (cat == view) {
                        $('.cat_' + cat).show();
                        toggleEye(cat, 'show');
                    } else {
                        $('.cat_' + cat).hide();
                        toggleEye(cat, 'hide');
                    }
                }
            }
        }

        function toggleEye(view, showhide = false) {
            if (!showhide) {
                if ($('#eye_' + view).attr('collapsed') == 'false') {
                    $('#eye_' + view).attr('src', 'assets/img/icon/eye_hide.png');
                    $('#eye_' + view).attr('collapsed', 'true');
                } else {
                    $('#eye_' + view).attr('src', 'assets/img/icon/eye_show.png');
                    $('#eye_' + view).attr('collapsed', 'false');
                }
            } else {
                if (showhide == 'show' && $('#eye_' + view).attr('collapsed') == 'true') {
                    $('#eye_' + view).attr('src', 'assets/img/icon/eye_show.png');
                    $('#eye_' + view).attr('collapsed', 'false');
                } else if (showhide == 'hide' && $('#eye_' + view).attr('collapsed') == 'false') {
                    $('#eye_' + view).attr('src', 'assets/img/icon/eye_hide.png');
                    $('#eye_' + view).attr('collapsed', 'true');
                }
            }
        }

        function collapseToolbar(toolbar) {
            $('#toolbar-' + toolbar).collapse('toggle');
            //console.log($('#toolbar-icon-' + toolbar).attr('collapsed'));
            if ($('#toolbar-icon-' + toolbar).attr('collapsed') == 'true') {
                $('#toolbar-icon-' + toolbar).removeClass('fa-plus');
                $('#toolbar-icon-' + toolbar).addClass('fa-minus');
                $('#toolbar-icon-' + toolbar).attr('collapsed', 'false');
            } else {
                $('#toolbar-icon-' + toolbar).removeClass('fa-minus');
                $('#toolbar-icon-' + toolbar).addClass('fa-plus');
                $('#toolbar-icon-' + toolbar).attr('collapsed', 'true');
            }
        }

        function toggleFill() {
            if ($('#eye_dep').attr('collapsed') == 'true') {
                $('a.bubble-node').each(function() {
                    $(this).css("fill", $(this).attr("fill"));
                });
                toggleEye('dep');
            } else {
                $('a.bubble-node').css("fill", "#ccc");
                toggleEye('dep');
            }
        }

        function filterByTag(category, tag, isInKeywords=false) { console.log("#" + category + tag.replace(" ", "-"));
            var hide = $("#" + category + tag.replace(" ", "-")).attr("filtered") == "true";
            $('a.bubble-node').each(function() {
                //var obj = $("#" + category + (isInKeywords ? tag.replace(" ", "-") : $(this).attr(category)));
                //var foundTag = isInKeywords ? $(this).attr("keywords").split(";").includes(tag) : $(this).attr(category) == tag;
                var obj = $("#" + category + (tag.replace(" ", "-")));
                var foundTag = $(this).attr(category).split(";").includes(tag);
                //if(isInKeywords) { 
                    //console.log($(this).attr("keywords").split(";").includes(tag) );
                //}
                if(foundTag && !hide) {
                    $(this).removeClass("hidden_" + category);
                    $("#label_" + $(this).attr("data-id").toString()).removeClass("hidden_" + category);
                    obj.attr("filtered", "true");
                    obj.addClass("selected");
                } else if ( ( !foundTag && obj.attr("filtered") != "true" )|| ( hide && foundTag ) ) {
                    obj.attr("filtered", "false");
                    obj.removeClass("selected");
                    var hideBubble = true;
                    if (isInKeywords) {
                        for (tagInCategory in tagsInCategories[category]) {
                            if ($("#" + category + tagsInCategories[category][tagInCategory].replace(" ", "-")).attr("filtered") == "true") {
                                hideBubble = false;
                            }
                        }
                    }
                    if(hideBubble) {
                        $(this).addClass("hidden_" + category);
                        $("#label_" + $(this).attr("data-id").toString()).addClass("hidden_" + category);
                    }
                }
            });
        }

        function replaceLayout(){
            var element = document.getElementById('toolbar_inside'),
            style = window.getComputedStyle(element),
            left = style.getPropertyValue('margin-left');
            document.getElementById('sidebar').setAttribute('style','margin-left:'+left);
            document.getElementById('vis').setAttribute('style','margin-left:'+left);
        }

    </script>
</head>

<body onresize="replaceLayout()">


    <!--div style="display: flex; justify-content: center;height: 30px;"-->
    <div class="topbar">
        <input class="searchInput" name="targetNode" type="text" />
        <button class="button">Search</button>
        <button class="reset">Reset</button>
        <span id="status"></span>&nbsp; &nbsp;
        <span class="">New</span>  &nbsp; &nbsp;
        <span onmouseup="toggleEdit();" >Edit</span>
    </div>


    <div id="edit-top-bar" class="topbar" style="display:none">
        <div class="row toolbar-header" id="edit_mode">
            <div class="col"  style="flex-grow:3.5;">
                EDIT MODE: You are editing the details of this dataset.
            </div>
            <div class="col">
                <img class="eyecon" onmouseup="toggleEdit()" style="height: 20px; margin-top:-5px" id="cancel" src="assets/img/cancel.svg"> 
                Cancel
            </div>
            <div class="col">
                <img class="eyecon" style="height: 20px; margin-top:-5px" id="save" src="assets/img/save.svg"> 
                Save
            </div>

        </div>
    </div>

    <!-- begin bubble-specific toolbar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div style="float:left;margin-left:15px;">
                <!--span class="dim_val">Dataset:</span!-->
                <span id="title-input" contenteditable="false">
                </span>
            </div>
            <!--div class="col dim_label" style="flex-grow:1;">
                <span class="dim_val">Contact:</span> 
                <span id="contact-input" contenteditable="false">
                </span>
            </div-->
            <div style="float:right;margin-right:10px;font-weight: normal;">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-meta" collapsed="true" onmouseup="collapseToolbar('meta')"></i>
            </div>
            <div class="col-auto">
            </div>
        </div>
        <div class="row collapse" id="toolbar-meta">
            <div class="col" style="padding-left:25px;">
                <div class="sidebar-items">
                    <div><b>Description:&nbsp;</b></div>
                    <div style="font-weight: 100" contentEditable="false" id="description-input">This dataset was created in 2012 to track the smoking habits of young adults over time</div>
                </div>
                <div class="sidebar-items">
                    <div>Keywords:&nbsp;&nbsp;</div>
                    <div contentEditable="false" style="font-weight: 100" id="keywords-input">Smoking, youngadults, 2012</div>
                </div>
            </div>
        </div>
    </div>

    <div class="containerZ" id="vizContainer">
    <!-- VISUALIZATION -->
        <div class="vizbar">
            <div id="data_main" style="display:none;"></div>
            <div id="vis"></div>
        </div>
    </div>
    <!-- begin first toolbar -->
    <div class="container toolbar" id="toolbar_inside">
        <div class="row toolbar-header">
            <div class="col dim_label" onmouseup="changeView('geo');">
                <img class="eyecon" id="eye_geo" collapsed="true" src="assets/img/icon/eye_hide.png"> Geo. Coverage
            </div>
            <div class="col dim_label" onmouseup="changeView('population');">
                <img class="eyecon" collapsed="true" id="eye_population" src="assets/img/icon/eye_hide.png"> Population
            </div>
            <div class="col dim_label" onmouseup="changeView('type');">
                <img class="eyecon" collapsed="false" id="eye_type" src="assets/img/icon/eye_show.png"> Type of Dataset
            </div>
            <div class="col dim_label" onmouseup="changeView('level');" style="flex-grow:0.5;">
                <img class="eyecon" collapsed="true" id="eye_level" src="assets/img/icon/eye_hide.png"> Level
            </div>
            <div class="col-auto">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-top" collapsed="true" onmouseup="collapseToolbar('top')"></i>
            </div>
        </div>
        <div class="row collapse" id="toolbar-top">
            <div class="col" id="geo_btn">
                <span class="geolevel toolbar-items">
                    <div style="float:left;">
                        <img src="assets/img/icon/geo_1.png" class="icon">
                    </div>
                    <div style="float:right;">
                        <div id="geo_1" class="item_geo" value="straat">
                            Straat
                        </div>
                        <div id="geo_2" class="item_geo" value="buurt">
                            Buurt
                        </div>
                        <div id="geo_3" class="item_geo" value="wijk">
                            Wijk
                        </div>
                    </div>
                </span>
                <span class="geolevel toolbar-items">
                    <div style="float:left;">
                        <img src="assets/img/icon/geo_2.png" class="icon" style="width:70px;height:70px;margin-right:-10px;margin-top:-10px">
                    </div>
                    <div style="float:right;">
                        <div id="geo_4" class="item_geo" value="gebied">
                            Gebied
                        </div>
                        <div id="geo_5" class="item_geo" value="stadsdeel">
                            Stadsdeel
                        </div>
                        <div id="geo_6" class="item_geo" value="stad">
                            Stad
                        </div>
                    </div>
                </span>
                <span class="geolevel toolbar-items">
                    <div style="float:left;"><img src="assets/img/icon/geo_3.png" class="icon"></div>
                    <div style="float:right;">
                        <div id="geo_7" class="item_geo" value="amstelland">
                            Amstelland
                        </div>
                        <div id="geo_8" class="item_geo" value="adam">
                            Metro. A'dam
                        </div>
                        <div id="geo_9" class="item_geo" value="g4">
                            G4
                        </div>
                        <div id="geo_10" class="item_geo" value="national">
                            National
                        </div>
                    </div>  
                </span>
            </div>
            <div class="col" id="pop_btn" style="flex-grow:1.5;margin-left:20px">
                <div class="toolbar-items">
                    <div style="float:left;" id="pop_1" class="item_population" value="youth">
                        <img src="assets/img/youth.svg" class="icon">
                        <br>Youth
                    </div>
                    <div style="float:right;" id="pop_2" class="item_population" value="young">
                        <img src="assets/img/young_adult.svg" class="icon">
                        <br>Young Adult
                    </div>
                </div>
                <div class="toolbar-items">
                    <div style="float:left;" id="pop_3" class="item_population" value="adult">
                        <img src="assets/img/adult.svg" class="icon">
                        <br>Adult
                    </div>
                    <div style="float:right;" id="pop_4" class="item_population" value="elderly">
                        <img src="assets/img/old_person.svg" class="icon">
                        <br>Elderly
                    </div>
                </div>
            </div>
            <div class="col" id="type_btn">
                <div class="toolbar-items" style="display:block;margin-right:-50px;">
                    <svg style="transform:scale(0.6);margin-left:-90px;margin-top:-30px;" height="300px" width="390px">
                       <g>
                         <ellipse cx="196.92" cy="81.52" rx="8.74" ry="41.07" id="type_shape_1" value="questionnaire"/>
                         <ellipse cx="160.19" cy="108.38" rx="8.74" ry="41.07" transform="translate(7.61 227.24) rotate(-72)" id="type_shape_5" value="socialmedia"/>
                         <ellipse cx="174.33" cy="151.68" rx="41.07" ry="8.74" transform="translate(-50.86 203.56) rotate(-54)" id="type_shape_4" value="promotion" />
                         <ellipse cx="219.71" cy="151.68" rx="8.74" ry="41.07" transform="matrix(0.81, -0.59, 0.59, 0.81, -47.2, 158.11)" id="type_shape_3" value="registry" />
                         <ellipse cx="233.86" cy="108.38" rx="41.07" ry="8.74" transform="translate(-22.05 77.57) rotate(-18)" id="type_shape_2" value="monitor" />
                         <text transform="translate(100 25.95)" id="type_1" value="questionnaire">
                            <tspan>Questionnaire</tspan>
                         </text>
                         <text transform="translate(286.87 84.56)" id="type_2" value="socialmedia">
                            <tspan>Social</tspan>
                            <tspan x="0" y="30">Media</tspan>
                         </text>
                         <text transform="translate(258.9 183.13)" id="type_3" value="promotion">
                            <tspan>Health</tspan>
                            <tspan x="0" y="30">Promotion</tspan>
                         </text>
                         <text transform="translate(44.52 212.13)" id="type_4" value="registry">
                            <tspan>Registry</tspan>
                         </text>
                         <text transform="translate(0 102.58)" id="type_5" value="monitor">
                            <tspan>Monitor</tspan>
                         </text>
                       </g>
                    </svg>
                </div>
            </div>
            <div class="col" id="level_btn" style="flex-grow:0.5;">
                <div class="toolbar-items level">
                    <div style="float:left;">
                        <div class="item_level" id="level_1" value="individual">
                            <img src="assets/img/icon/level_1_individual.png" class="icon" id="type_1" value="questionnaire">
                            <br>Individual
                        </div>
                        <div class="item_level" id="level_2" value="family">
                            <img src="assets/img/icon/level_2_family.png" class="icon">
                            <br>Family
                        </div>
                        <div class="item_level" id="level_3" value="group">
                            <img src="assets/img/icon/level_3_group.png" class="icon">
                            <br>Group
                        </div>
                    </div>
                    <div style="float:right;margin-left:10px">
                        <div class="item_level" id="level_4" value="orga">
                            <img src="assets/img/icon/level_4_orga.png" class="icon">
                            <br>Organization
                        </div>
                        <div class="item_level" id="level_5" value="geographic">
                            <img src="assets/img/icon/level_5_geo.png" class="icon">
                            <br>Geography
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- begin second toolbar -->
    <div class="container toolbar">
        <div class="row toolbar-header">
            <div class="col dim_label" id="toggle_size" onmouseup="removeSize();" style="flex-grow:1.7;">
                <img class="eyecon" collapsed="false" id="eye_size" src="assets/img/icon/eye_show.png"> Number of Cases
            </div>
            <div class="col dim_label" onmouseup="toggleFill();" style="flex-grow:1.2;">
                <img class="eyecon" id="eye_dep" collapsed="false" src="assets/img/icon/eye_show.png"> Ownership
            </div>
            <div class="col dim_label" onmouseup="changeView('time','.arc');">
                <img class="eyecon" id="eye_time" collapsed="false" src="assets/img/icon/eye_show.png"> Temporal Coverage 
            </div>
            <div class="col-auto">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-bottom" collapsed="true" onmouseup="collapseToolbar('bottom')"></i>
            </div>
        </div>
        <div class="row collapse" id="toolbar-bottom">
            <div class="col" id="size_btn">
                <div id="caseGraph" style="display: block" class="toolbar-items">
                    <svg width="80%" version="1.1" id="Layer_1_Size" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 272.83 264.97"xml:space="preserve">
                       <style type="text/css">
                           .st0{fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10;}
                           .st1{font-family:'OpenSans';}
                           .st2{font-size:18px;margin-left:4px;}
                       </style>
                       <g class="size" data-size="more" id="size_5" value="0">
                           <circle class="st0" cx="138.54" cy="131.83" r="125"/>
                           <text transform="matrix(1 0 0 1 111.3019 36.1381)" class="st1 st2">More</text>
                       </g>
                       <g class="size" data-size="2000" id="size_4" value="2000">
                           <circle class="st0" cx="138.54" cy="158.6" r="100" />
                           <text transform="matrix(1 0 0 1 113.3809 87.7564)" class="st1 st2">2000</text>
                       </g>
                       <g class="size" data-size="1000" id="size_3" value="1000">
                           <circle class="st0" cx="138.54" cy="183.6" r="75" />
                           <text transform="matrix(1 0 0 1 113.381 139.375)" class="st1 st2">1000</text>
                       </g>
                       <g class="size" data-size="500" id="size_2" value="500">
                           <circle class="st0" cx="138.54" cy="208.6" r="50" />
                           <text transform="matrix(1 0 0 1 119.6702 188.9935)" class="st1 st2">500</text>
                       </g>
                       <g class="size" data-size="100" id="size_1" value="100">
                           <circle class="st0" cx="138.54" cy="226.83" r="30" />
                           <text transform="matrix(1 0 0 1 119.6704 234.6115)" class="st1 st2">100</text>
                       </g>
                   </svg>
                </div>
                <div id="caseInput" style="display: none" class="toolbar-items">
                    <span>
                        <form>
                            <label for="cases">Cases</label>
                            <input type="number" id="cases" name="age">
                        </form>
                    </span>
                    <span>
                        <form>
                            <label for="unit">Unit</label>
                            <input  id="unit" name="age">
                        </form>
                    </span>
                </div>
            </div>
            <div class="col" id="dep_btn" style="flex-grow:1.2;">
                <div class="toolbar-items ownership">
                    <div style="float:left;">
                        <div id="dep_1" value="EGZ">
                            <span class="dep_circle dep_EGZ"></span> 
                            EGZ
                        </div>
                        <div id="dep_2" value="IZ">
                            <span class="dep_circle dep_IZ"></span> 
                            IZ
                        </div>
                        <div id="dep_3" value="JGZ">
                            <span class="dep_circle dep_JGZ"></span> 
                            JGZ
                        </div>
                        <div id="dep_4" value="VT">
                            <span class="dep_circle dep_VT"></span> 
                            VT
                        </div>
                        <div id="dep_5" value="MGGZ">
                            <span class="dep_circle dep_MGGZ"></span> 
                            MGGZ
                        </div>
                    </div>
                    <div style="float:right; margin-left:-20px">
                        <div id="dep_6" value="FGMA">
                            <span class="dep_circle dep_FGMA"></span> 
                            FGMA
                        </div>
                        <div id="dep_7" value="GHOR">
                            <span class="dep_circle dep_GHOR"></span> 
                            GHOR
                        </div>
                        <div id="dep_8" value="LO">
                            <span class="dep_circle dep_LO"></span> 
                            LO
                        </div>
                        <div id="dep_9" value="AAGG">
                            <span class="dep_circle dep_AAGG"></span> 
                            AAGG
                        </div>
                    </div>
                </div>
            </div>
            <div class="col" id="time_btn">
                <div class="toolbar-items">
                    <svg id="timedimsvg">
                        <style type="text/css">
                            .time_st0{fill:none;}
                            .time_st1{fill:none;stroke:#231F20;stroke-width:5;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st2{fill:none;stroke:#231F20;stroke-width:4.694;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st3{fill:none;stroke:#231F20;stroke-width:4.388;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st4{fill:none;stroke:#231F20;stroke-width:4.083;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st5{fill:none;stroke:#231F20;stroke-width:3.777;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st6{fill:none;stroke:#231F20;stroke-width:3.472;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st7{fill:none;stroke:#231F20;stroke-width:3.166;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st8{fill:none;stroke:#231F20;stroke-width:2.861;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st9{fill:none;stroke:#231F20;stroke-width:2.555;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st10{fill:none;stroke:#231F20;stroke-width:2.25;stroke-linecap:round;stroke-dasharray:0,6.5;}
                            .time_st11{display:none;}
                            .time_st12{display:inline;fill:none;stroke:#000000;stroke-width:24;stroke-miterlimit:10;}
                            .time_st13{display:inline;fill:none;stroke:#FFFFFF;stroke-width:6;stroke-miterlimit:10;}
                            .time_st14{display:inline;fill:none;stroke:#FFFFFF;stroke-width:11;stroke-miterlimit:10;}
                            .time_st15{fill:url(#Undulating_Coarse_Dots);}
                            .time_st16{fill:none;stroke:#000000;stroke-width:3;stroke-miterlimit:10;}
                            .time_st17{font-family:'OpenSans';}
                            .time_font{font-size:22px;font-weight: normal;}
                        </style>
                        <pattern  x="-647.91" y="-473.44" width="83" height="65" patternUnits="userSpaceOnUse" id="Undulating_Coarse_Dots" viewBox="2.5 -133 83 65" style="overflow:visible;">
                            <g>
                                <line class="time_st1" x1="2.5" y1="-133" x2="2.5" y2="-67.5"/>
                                <line class="time_st2" x1="7.11" y1="-136.25" x2="7.11" y2="-67.5"/>
                                <line class="time_st3" x1="11.72" y1="-133" x2="11.72" y2="-67.5"/>
                                <line class="time_st4" x1="16.33" y1="-136.25" x2="16.33" y2="-67.5"/>
                                <line class="time_st5" x1="20.94" y1="-133" x2="20.94" y2="-67.5"/>
                                <line class="time_st6" x1="25.56" y1="-136.25" x2="25.56" y2="-67.5"/>
                                <line class="time_st7" x1="30.17" y1="-133" x2="30.17" y2="-67.5"/>
                                <line class="time_st8" x1="34.78" y1="-136.25" x2="34.78" y2="-67.5"/>
                                <line class="time_st9" x1="39.39" y1="-133" x2="39.39" y2="-67.5"/>
                                <line class="time_st10" x1="44" y1="-136.25" x2="44" y2="-67.5"/>
                                <line class="time_st1" x1="85.5" y1="-133" x2="85.5" y2="-67.5"/>
                                <line class="time_st2" x1="80.89" y1="-136.25" x2="80.89" y2="-67.5"/>
                                <line class="time_st3" x1="76.28" y1="-133" x2="76.28" y2="-67.5"/>
                                <line class="time_st4" x1="71.67" y1="-136.25" x2="71.67" y2="-67.5"/>
                                <line class="time_st5" x1="67.06" y1="-133" x2="67.06" y2="-67.5"/>
                                <line class="time_st6" x1="62.44" y1="-136.25" x2="62.44" y2="-67.5"/>
                                <line class="time_st7" x1="57.83" y1="-133" x2="57.83" y2="-67.5"/>
                                <line class="time_st8" x1="53.22" y1="-136.25" x2="53.22" y2="-67.5"/>
                                <line class="time_st9" x1="48.61" y1="-133" x2="48.61" y2="-67.5"/>
                            </g>
                        </pattern>
                        <g>
                            <path class="year_1" d="M251.97,68.36l8.21-22.57c-12.84-4.34-26.53-6.82-40.75-7.13v24C230.77,62.97,241.7,64.95,251.97,68.36z"/>
                            <path class="year_2"  d="M286.28,86.86l15.42-18.38c-10.76-8.58-22.84-15.58-35.88-20.64l-8.21,22.55C268.01,74.48,277.65,80.06,286.28,86.86z"/>
                            <path class="year_3"  d="M312.34,115.94l20.79-12c-7.31-11.85-16.36-22.51-26.81-31.61L290.89,90.7C299.21,98.01,306.45,106.51,312.34,115.94z"/>
                            <path class="year_4"  d="M326.99,152.23l23.66-4.17c-2.84-13.86-7.79-26.95-14.48-38.95l-20.78,12C320.7,130.72,324.66,141.18,326.99,152.23z"/>
                            <path class="year_5"  d="M329.44,175.63c0,5.37-0.39,10.65-1.11,15.82l23.65,4.17c0.96-6.53,1.46-13.2,1.46-19.99c0-7.37-0.59-14.61-1.72-21.67
                                l-23.64,4.17C328.97,163.84,329.44,169.68,329.44,175.63z"/>
                            <path class="year_6"  d="M316.1,228.84l20.79,12.01c6.59-12.12,11.39-25.35,14.08-39.31l-23.64-4.17C325.15,208.53,321.31,219.11,316.1,228.84z"/>
                            <path class="year_7"  d="M291.72,259.82l15.42,18.38c10.47-9.27,19.52-20.11,26.76-32.15l-20.78-12C307.29,243.68,300.06,252.36,291.72,259.82z"/>
                            <path class="year_8"  d="M258.16,280.64l8.21,22.56c13.18-5.18,25.36-12.34,36.19-21.12l-15.42-18.38C278.45,270.7,268.69,276.44,258.16,280.64z"/>
                            <path class="year_9"  d="M219.44,288.59v24c14.42-0.31,28.3-2.86,41.31-7.32l-8.21-22.56C242.1,286.25,230.98,288.29,219.44,288.59z"/>
                            <path class="year_10"  d="M180.34,282.72l-8.21,22.56c13,4.46,26.88,7.01,41.31,7.32v-24C201.89,288.29,190.78,286.25,180.34,282.72z"/>
                            <path class="year_11"  d="M145.73,263.7l-15.42,18.38c10.83,8.78,23.01,15.95,36.19,21.12l8.21-22.56C164.18,276.45,154.43,270.7,145.73,263.7z"/>
                            <path class="year_12"  d="M119.75,234.06l-20.78,12c7.25,12.04,16.29,22.88,26.76,32.15l15.42-18.38C132.81,252.36,125.58,243.68,119.75,234.06z"/>
                            <path class="year_13"  d="M105.54,197.37l-23.64,4.17c2.68,13.97,7.49,27.19,14.08,39.31l20.79-12.01C111.56,219.11,107.73,208.53,105.54,197.37z"/>
                            <path class="year_14"  d="M103.44,175.63c0-5.95,0.47-11.8,1.36-17.5l-23.64-4.17c-1.13,7.06-1.72,14.3-1.72,21.67c0,6.79,0.5,13.46,1.46,19.99
                                l23.65-4.17C103.82,186.28,103.44,181,103.44,175.63z"/>
                            <path class="year_15"  d="M117.49,121.11l-20.78-12c-6.69,12-11.64,25.09-14.48,38.95l23.66,4.17C108.22,141.18,112.17,130.72,117.49,121.11z"/>
                            <path class="year_16"  d="M141.98,90.7l-15.42-18.38c-10.45,9.1-19.51,19.76-26.81,31.61l20.79,12C126.42,106.51,133.66,98.01,141.98,90.7z"/>
                            <path class="year_17"  d="M175.26,70.4l-8.21-22.55c-13.04,5.06-25.12,12.05-35.88,20.64l15.42,18.38C155.22,80.06,164.87,74.48,175.26,70.4z"/>
                            <path class="time_st15 year_18" d="M213.44,62.67v-24c-14.22,0.31-27.91,2.79-40.75,7.13l8.21,22.57C191.18,64.95,202.1,62.97,213.44,62.67z"/>
                            <path class="time_st16 year_18" d="M172.69,45.79l8.21,22.57"/>
                            <text transform="matrix(1 0 0 1 226.8767 34.4286)" class="time_font year_1" id='year_1'>2020</text>
                            <text transform="matrix(1 0 0 1 288.203 55.0738)" class="time_font year_2" id='year_2'>2019</text>
                            <text transform="matrix(1 0 0 1 324.1019 86.1158)" class="time_font year_3" id='year_3'>2018</text>
                            <text transform="matrix(1 0 0 1 350.9763 129.6168)" class="time_font year_4" id='year_4'>2017</text>
                            <text transform="matrix(1 0 0 1 360.2678 181.1421)" class="time_font year_5" id='year_5'>2016</text>
                            <text transform="matrix(1 0 0 1 351.2869 232.2453)" class="time_font year_6" id='year_6'>2015</text>
                            <text transform="matrix(1 0 0 1 329.8593 277.4357)" class="time_font year_7" id='year_7'>2014</text>
                            <text transform="matrix(1 0 0 1 291.1594 312.4897)" class="time_font year_8" id='year_8'>2013</text>
                            <text transform="matrix(1 0 0 1 225.2744 333.184)" class="time_font year_9" id='year_9'>2012</text>
                            <text transform="matrix(1 0 0 1 158.9091 333.1849)" class="time_font year_10" id='year_10'>2011</text>
                            <text transform="matrix(1 0 0 1 94.0241 312.4899)" class="time_font year_11" id='year_11'>2010</text>
                            <text transform="matrix(1 0 0 1 55.0136 277.4355)" class="time_font year_12" id='year_12'>2009</text>
                            <text transform="matrix(1 0 0 1 31.3626 232.2451)" class="time_font year_13" id='year_13'>2008</text>
                            <text transform="matrix(1 0 0 1 22.0711 181.1423)" class="time_font year_14" id='year_14'>2007</text>
                            <text transform="matrix(1 0 0 1 33.0519 129.6168)" class="time_font year_15" id='year_15'>2006</text>
                            <text transform="matrix(1 0 0 1 59.3923 86.1158)" class="time_font year_16" id='year_16'>2005</text>
                            <text transform="matrix(1 0 0 1 97.2475 55.0739)" class="time_font year_17" id='year_17'>2004</text>
                            <text transform="matrix(1 0 0 1 146.6807 34.4285)" class="time_font year_18" id='year_18'>earlier</text>
                        </g>
                    </svg>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- D3 JS -->
    <script src="assets/js/libs/d3.min.js"></script>
    <script src="assets/js/libs/d3-scale.v3.min.js"></script>
    <script src="assets/js/libs/d3-path.v1.min.js"></script>
    <script src="assets/js/libs/d3-shape.v1.min.js"></script>

    <script defer src="assets/js/plugins.js"></script>
    <script src="assets/js/libs/coffee-script.js"></script>
    <script type="text/coffeescript" src="assets/coffee/vis.coffee"></script>

    <script type="text/javascript">


        function removeSize(){

            // Reset circles
            d3.selectAll(".bubble-node")
                .selectAll("circle")
                .attr('r', 30);

            // Reset pies
            d3.selectAll(".bubble-node")
                .each(function(d) {
                    d.forceR = 36;
                })
                .selectAll(".pie")
                .attr('transform','scale(0.33,0.33)');

            // Reset images
            d3.selectAll(".bubble-node")
                .selectAll("image")
                .attr('width',43)
                .attr('height',43)
                .style("transform", "translate(-"+ 35*0.555 +'px,-'+ 35*0.6 +'px)');

            document.getElementById('toggle_size').setAttribute('onmouseup','restoreSize()');

            redraw();
            
        }

        function restoreSize(){

            // Reset circles
            d3.selectAll(".bubble-node")
                .selectAll("circle")
                .attr('r', function(d) {
                    return Math.max(12, rScale(rValue(d))-4 );
                });

            // Reset pies
            d3.selectAll(".bubble-node")
                .each(function(d) {
                    d.forceR = Math.max(16, rScale(rValue(d)));
                })
                .selectAll(".pie")
                    .attr("transform", function(d) {
                        return "scale(" + rScale(rValue(d))/100 + "," + rScale(rValue(d))/100 + ")";
                    });

            // Reset images
            d3.selectAll(".bubble-node")
                .selectAll("image")
                  .attr("width",  function(d) {
                        return rScale(rValue(d)) * 1.15 ;
                    })
                  .attr("height", function(d) {
                        return rScale(rValue(d)) * 1.15 ;
                    })
                  .style("transform", function(d) {
                        return "translate(-"+ rScale(rValue(d))*0.555 +'px,-'+ rScale(rValue(d))*0.6 +'px)' ;
                    });

            document.getElementById('toggle_size').setAttribute('onmouseup','removeSize()');

            redraw();
            
        }

        //////////////////////////////////////////
        // FILTER BUBBLES
        //////////////////////////////////////////
        // Filter bubbles using environment variables
        // that store the selected filters for each dimension,
        // e.g.: keep_geo_label, keep_dep_label ...

        function filterBubbles(){

            // Hide all
            d3.selectAll(".bubble-node")
                .each(function(d) {
                    d.ui_scale = 0;
                    d.forceR = 0;
                });

            // Select Bubbles to show
            d3.selectAll(".bubble-node")
                .filter(function(d) { 
                    pop_values = d.population.split(";").map( function(currentValue, index, arr){
                        return keep_pop_label.includes(currentValue);
                    });
                    type_values = d.type.split(";").map( function(currentValue, index, arr){
                        return keep_type_label.includes(currentValue);
                    });
                    year_values = d.time.split(";").map( function(currentValue, index, arr){
                        currentValue = currentValue * 1;
                        if(currentValue < new Date().getFullYear() - 17){
                            currentValue = new Date().getFullYear() - 17;
                        }
                        return keep_year_label.includes(currentValue);
                    });
                    size_test = false;
                    if(d.size > 2000 & keep_size_label.indexOf("0") != -1){
                        size_test = true;
                    } else if(
                        (keep_size_label.indexOf("2000") != -1 & d.size <= 2000 & d.size > 1000 ) |
                        (keep_size_label.indexOf("1000") != -1 & d.size <= 1000 & d.size > 500 ) |
                        (keep_size_label.indexOf("500") != -1 & d.size <= 500 & d.size > 100 ) |
                        (keep_size_label.indexOf("100") != -1 & d.size <= 100 ) 
                    ){
                        size_test = true;
                    }
                    return (
                        keep_geo_label.indexOf(d.geo) != -1 &
                        keep_level_label.indexOf(d.level) != -1 &
                        keep_dep_label.indexOf(d.department) != -1 &
                        pop_values.includes(true) &
                        type_values.includes(true) &
                        year_values.includes(true) &
                        size_test
                        );  
                }).each(function(d) {
                    d.ui_scale = 1;
                    d.forceR = Math.max(12, rScale(rValue(d)));
                });
             
            // Animate graph
            redraw();
            
        }
        
        //////////////////////////////////////////
        // FILTER GEO
        //////////////////////////////////////////

        btn = document.getElementsByClassName('item_geo');
        for (var i = 0; i < btn.length; i++) {
            btn[i].setAttribute("onclick", "filterByGeo('" + btn[i].getAttribute('value') + "')");
        }

        var keep_geo_label = ['straat','buurt','wijk','gebied','stadsdeel','stad','amstelland','adam','g4','national'];
        
        function filterByGeo(label){
            ////////// Get the labels to filter on
            index_label = keep_geo_label.indexOf(label);
            if(keep_geo_label.length == 10){
                keep_geo_label = [label];
            } else if(index_label > -1){
                keep_geo_label.splice(index_label, 1);
            } else {
                keep_geo_label.push(label);
            }
            if(keep_geo_label.length == 0){
                keep_geo_label = ['straat','buurt','wijk','gebied','stadsdeel','stad','amstelland','adam','g4','national'];
            }

            ////////////// Show/Hide Hide/Show UI buttons
            var item_geo = document.getElementsByClassName('item_geo');
            for (var i = 0; i < item_geo.length; i++) {
                
                in_keep_geo_label = keep_geo_label.indexOf( item_geo[i].getAttribute('value') );

                if ( in_keep_geo_label > -1){
                    item_geo[i].setAttribute('style','color:#000;');
                } else {
                    item_geo[i].setAttribute('style','color:#999;');
                }
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        //////////////////////////////////////////
        // FILTER POPULATION
        //////////////////////////////////////////
        for (var i = 1; i < 5; i++) {
            btn = document.getElementById('pop_' + i);
            btn.setAttribute("onclick", 'filterByPop("' + btn.getAttribute('value') + '")');
        }
        
        var keep_pop_label = ['young', 'youth', 'adult', 'elderly'];
        
        function filterByPop(label){
            ////////// Get the labels to filter on
            index_label = keep_pop_label.indexOf(label);

            if(keep_pop_label.length == 4){
                keep_pop_label = [label];
            } else if(index_label > -1){
                keep_pop_label.splice(index_label, 1);
            } else {
                keep_pop_label.push(label);
            }
            if(keep_pop_label.length == 0){
                keep_pop_label = ['young', 'youth', 'adult', 'elderly'];
            }
            
            ////////////// Show/Hide Hide/Show UI buttons
            for (var i = 1; i < 5; i++) {
                btn = document.getElementById('pop_' + i);
                in_keep_pop_label = keep_pop_label.indexOf( btn.getAttribute('value') );

                if ( in_keep_pop_label > -1){
                    btn.setAttribute('style','color:#000;');
                } else {
                    btn.setAttribute('style','color:#999;');
                }
                
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        //////////////////////////////////////////
        // FILTER TYPE
        //////////////////////////////////////////
        for (var i = 1; i < 6; i++) {
            btn = document.getElementById('type_' + i);
            btn.setAttribute("onclick", 'filterByType("' + btn.getAttribute('value') + '")');
            btn = document.getElementById('type_shape_' + i);
            btn.setAttribute("onclick", 'filterByType("' + btn.getAttribute('value') + '")');
        }
        
        var keep_type_label = ['questionnaire', 'socialmedia', 'promotion', 'registry', 'monitor'];
        
        function filterByType(label){
            ////////// Get the labels to filter on
            index_label = keep_type_label.indexOf(label);

            if(keep_type_label.length == 5){
                keep_type_label = [label];
            } else if(index_label > -1){
                keep_type_label.splice(index_label, 1);
            } else {
                keep_type_label.push(label);
            }
            if(keep_type_label.length == 0){
                keep_type_label = ['questionnaire', 'socialmedia', 'promotion', 'registry', 'monitor'];
            }
            
            //console.log(keep_type_label);

            ////////////// Show/Hide Hide/Show UI buttons
            for (var i = 1; i < 6; i++) {
                btn = document.getElementById('type_' + i);
                in_keep_type_label = keep_type_label.indexOf( btn.getAttribute('value') );

                if ( in_keep_type_label > -1){
                    btn.setAttribute('style','fill:#000;');
                    document.getElementById('type_shape_' + i).setAttribute('style','fill:#000;');
                } else {
                    btn.setAttribute('style','fill:#666;');
                    document.getElementById('type_shape_' + i).setAttribute('style','fill:#ccc;');
                }
                
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        //////////////////////////////////////////
        // FILTER LEVELS
        //////////////////////////////////////////
        for (var i = 1; i < 6; i++) {
            btn = document.getElementById('level_' + i);
            btn.setAttribute("onclick", 'filterByLevel("' + btn.getAttribute('value') + '")');
        }
        
        var keep_level_label = ['individual', 'family', 'group', 'orga', 'geographic'];
        
        function filterByLevel(label){
            ////////// Get the labels to filter on
            index_label = keep_level_label.indexOf(label);

            if(keep_level_label.length == 5){
                keep_level_label = [label];
            } else if(index_label > -1){
                keep_level_label.splice(index_label, 1);
            } else {
                keep_level_label.push(label);
            }
            if(keep_level_label.length == 0){
                keep_level_label = ['individual', 'family', 'group', 'orga', 'geographic'];
            }

            ////////////// Show/Hide Hide/Show UI buttons
            for (var i = 1; i < 6; i++) {
                btn = document.getElementById('level_' + i);
                in_keep_level_label = keep_level_label.indexOf( btn.getAttribute('value') );

                if ( in_keep_level_label > -1){
                    btn.setAttribute('style','color:#000;');
                } else {
                    btn.setAttribute('style','color:#999;');
                }
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        //////////////////////////////////////////
        // FILTER SIZE
        //////////////////////////////////////////
        $(".size").each(function() {

            $(this).mouseover(function() {
                $(this).find(".st0").css("fill", "#d4d4d4");
                $(this).find(".st1").css("fill", "#000");
            });
            $(this).mouseout(function() {
                if(keep_size_label.length == 5){
                    $(this).find(".st0").css("fill", "#fff");
                    $(this).find(".st1").css("fill", "#000");
                } else {
                    selected = keep_size_label.indexOf( $(this).attr("value") ) > -1;
                    $(this).find(".st0").css("fill", selected ? "#d4d4d4" : "#f7f7f7");
                    $(this).find(".st1").css("fill", selected ? "#000" : "#888");
                }
            });
            $(this).click(function() {
                showSize($(this).attr("value"));
            });
        });
        
        var keep_size_label = ['100', '500', '1000', '2000', '0'];

        //Filter Number of Cases
        function showSize(label) {
            ////////// Get the labels to filter on
            index_label = keep_size_label.indexOf(label);

            if(keep_size_label.length == 5){
                keep_size_label = [label];
            } else if(index_label > -1){
                keep_size_label.splice(index_label, 1);
            } else {
                keep_size_label.push(label);
            }
            if(keep_size_label.length == 0){
                keep_size_label = ['100', '500', '1000', '2000', '0'];
            }

            ////////////// Show/Hide Hide/Show UI buttons
            for (var i = 1; i < 6; i++) {
                btn = document.getElementById('size_' + i);
                in_keep_size_label = keep_size_label.indexOf( btn.getAttribute('value') );

                if ( in_keep_size_label > -1){
                    btn.children[0].setAttribute('style',(keep_size_label.length == 5) ? 'fill:#fff;' : 'fill:#d4d4d4;');
                    btn.children[1].setAttribute('style','fill:#000;');
                } else {
                    btn.children[0].setAttribute('style','fill:#f7f7f7;');
                    btn.children[1].setAttribute('style', 'fill:#888;' );               
                }
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }
        

        //////////////////////////////////////////
        // FILTER DEPARTMENT
        //////////////////////////////////////////
        for (var i = 1; i < 10; i++) {
            btn = document.getElementById('dep_' + i);
            btn.setAttribute("onclick", 'filterByDep("' + btn.getAttribute('value') + '")');
        }
        
        var keep_dep_label = ['EGZ', 'IZ', 'JGZ', 'VT', 'MGGZ', 'FGMA', 'GHOR', 'LO', 'AAGG'];
        
        function filterByDep(label){
            ////////// Get the labels to filter on
            index_label = keep_dep_label.indexOf(label);

            if(keep_dep_label.length == 9){
                keep_dep_label = [label];
            } else if(index_label > -1){
                keep_dep_label.splice(index_label, 1);
            } else {
                keep_dep_label.push(label);
            }
            if(keep_dep_label.length == 0){
                keep_dep_label = ['EGZ', 'IZ', 'JGZ', 'VT', 'MGGZ', 'FGMA', 'GHOR', 'LO', 'AAGG'];
            }

            ////////////// Show/Hide Hide/Show UI buttons
            for (var i = 1; i < 10; i++) {
                btn = document.getElementById('dep_' + i);
                in_keep_dep_label = keep_dep_label.indexOf( btn.getAttribute('value') );

                if ( in_keep_dep_label > -1){
                    btn.setAttribute('style','color:#000;');
                } else {
                    btn.setAttribute('style','color:#999;');
                }
                
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        //////////////////////////////////////////
        // FILTER YEARS
        //////////////////////////////////////////

        // Fill in years, starting with current year.
        function updateYears(xml_id, year_gap){
            var fill_year = new Date().getFullYear() - year_gap ;
            document.getElementById(xml_id).textContent = fill_year;
            //document.getElementById(xml_id).setAttribute("value", new Date().getFullYear() - year_gap);
            var class_elem = document.getElementsByClassName(xml_id);
            for (var i = 0; i < class_elem.length; i++) {
                class_elem[i].setAttribute("value", fill_year);
                class_elem[i].setAttribute("onclick", 'filterByYear(' + fill_year + ')');
            }
        }

        for (var i = 1; i < 19; i++) {
            updateYears("year_" + i, i-1);
        }

        document.getElementById("year_18").textContent = 'earlier';
        //var class_earlier = document.getElementsByClassName("year_18");
        //for (var i = 0; i < class_earlier.length; i++) {
        //    class_earlier[i].setAttribute("value", 0);
        //}

        var keep_year_label = [];
        var today = new Date().getFullYear();
        for(var i = 0; i < 18; i++){
            keep_year_label.push(today - i);
        }

        function filterByYear(label){
            ////////// Get the labels to filter on
            index_label = keep_year_label.indexOf(label);

            if(keep_year_label.length == 18){
                keep_year_label = [label];
            } else if(index_label > -1){
                keep_year_label.splice(index_label, 1);
            } else {
                keep_year_label.push(label);
            }
            if(keep_year_label.length == 0){
                keep_year_label = [];
                for(var i = 0; i < 18; i++){
                    keep_year_label.push(today - i);
                }
            }

            ////////////// Show/Hide Hide/Show UI buttons
            for(var y = 1; y < 19; y++){
                var class_elem = document.getElementsByClassName("year_" + y);
                for (var i = 0; i < class_elem.length; i++) {

                    in_keep_year_label = keep_year_label.indexOf( class_elem[i].getAttribute('value')*1 );

                    if ( in_keep_year_label > -1){
                        class_elem[i].setAttribute('style','opacity:1;');
                    } else {
                        class_elem[i].setAttribute('style','opacity:0.3;');
                    }
                }
                
            }

            //////////// Filter the Bubbles
            filterBubbles();
        }

        collapseToolbar('meta');

        replaceLayout();
    </script>
</body>

</html>