<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/custom_style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <script src="https://dss.cloud/fa/js/all.min.js"></script>
    <link rel="stylesheet" type="text/css"  href="./assets/css/custom_style.css">
    <title>GGD Dashboard</title>
    <script src="assets/js/libs/modernizr-2.0.6.min.js"></script>
    <script>
        var categories = ["Population", "Dataset", "Coverage", "Level"];
        var tagsInCategories = []; 
        var editMode = false;
        // Toggle edit mode by making input fields Editable and showing relevant fields
        function toggleEdit() {
            if (!editMode) {
                document.getElementById("edit-top-bar").style.display = "block";
                document.getElementById("title-input").contentEditable = true;
                document.getElementById("contact-input").contentEditable = true;
                document.getElementById("description-input").contentEditable = true;
                document.getElementById("keywords-input").contentEditable = true;

                //show case input fields
                document.getElementById("caseGraph").style.display = "none";
                document.getElementById("caseInput").style.display = "block";


                //blurs all geo levels
                var buttons = document.getElementsByClassName('geolevel');
                for (var i = 0; i < buttons.length; i++) {
                    console.log(buttons[i].style.opacity);
                    buttons[i].classList.add("faded")
                }

                $('.geoLevel').click(function(e) {
                    $(this).toggleClass('faded'); //you can list several class names 
                    e.preventDefault();
                });



                editMode = true;

            } else if (editMode) {
                document.getElementById("edit-top-bar").style.display = "none";
                document.getElementById("title-input").contentEditable = false;
                document.getElementById("contact-input").contentEditable = false;
                document.getElementById("description-input").contentEditable = false;
                document.getElementById("keywords-input").contentEditable = false;

                //hide case input fields
                document.getElementById("caseGraph").style.display = "block";
                document.getElementById("caseInput").style.display = "none";
                editMode = false;

            }

        }

        function changeView(view, c = false) {
            if (c) {
                $(c).toggle();
                toggleEye(view);
            } else {
                for (category in categories) {
                    cat = categories[category]
                    if (cat == view) {
                        $('.cat' + cat).show();
                        toggleEye(cat, 'show');
                        console.log("Showing" + categories[category]);
                    } else {
                        $('.cat' + cat).hide();
                        console.log("Hiding" + categories[category]);
                        toggleEye(cat, 'hide');
                    }
                }
            }
        }

        function toggleEye(view, showhide = false) {
            if (!showhide) {
                if ($('#eye' + view).attr('collapsed') == 'false') {
                    $('#eye' + view).attr('src', 'assets/img/icon/eye_hide.png');
                    $('#eye' + view).attr('collapsed', 'true');
                } else {
                    $('#eye' + view).attr('src', 'assets/img/icon/eye_show.png');
                    $('#eye' + view).attr('collapsed', 'false');
                }
            } else {
                if (showhide == 'show' && $('#eye' + view).attr('collapsed') == 'true') {
                    $('#eye' + view).attr('src', 'assets/img/icon/eye_show.png');
                    $('#eye' + view).attr('collapsed', 'false');
                } else if (showhide == 'hide' && $('#eye' + view).attr('collapsed') == 'false') {
                    $('#eye' + view).attr('src', 'assets/img/icon/eye_hide.png');
                    $('#eye' + view).attr('collapsed', 'true');
                }
            }
        }

        function collapseToolbar(toolbar) {
            $('#toolbar-' + toolbar).collapse('toggle');
            //console.log($('#toolbar-icon-' + toolbar).attr('collapsed'));
            if ($('#toolbar-icon-' + toolbar).attr('collapsed') == 'true') {
                $('#toolbar-icon-' + toolbar).removeClass('fa-plus');
                $('#toolbar-icon-' + toolbar).addClass('fa-minus');
                $('#toolbar-icon-' + toolbar).attr('collapsed', 'false');
            } else {
                $('#toolbar-icon-' + toolbar).removeClass('fa-minus');
                $('#toolbar-icon-' + toolbar).addClass('fa-plus');
                $('#toolbar-icon-' + toolbar).attr('collapsed', 'true');
            }
        }

        function toggleFill() {
            if ($('#eyeOwnership').attr('collapsed') == 'true') {
                $('a.bubble-node').each(function() {
                    $(this).css("fill", $(this).attr("fill"));
                });
                toggleEye('Ownership');
            } else {
                $('a.bubble-node').css("fill", "#D31145");
                toggleEye('Ownership');
            }
        }
        //Filter Number of Cases
        function showSize(s) {
            console.log("Checking...");
            console.log(s);
            s = isNaN(s) ? s : Number(s);
            $('a.bubble-node').each(function() {
                console.log($(this).attr('size'));
                if (Number($(this).attr('size')) <= s && $("#size_" + s).attr("filtered") != 'true') {
                    console.log("Now hiding..." + s.toString());
                    //d3.select("#node_" + $(this).attr("data-id").toString()).remove();
                    //d3.select("#label_" + $(this).attr("data-id").toString()).style("visibility", "hidden");
                    $(this).addClass("hidden_size");
                    $("#label_" + $(this).attr("data-id").toString()).addClass("hidden_size");
                } else {
                    $(this).removeClass("hidden_size");
                    $("#label_" + $(this).attr("data-id").toString()).removeClass("hidden_size");
                }
            });
            $('g.size').each(function() {
                if ((Number($(this).attr("data-size")) == s && $(this).attr("filtered") != 'true') || (Number($(this).attr("data-size")) < s)) {
                    $(this).find(".st0").css("fill", "yellow");
                    $(this).attr("filtered", "true");
                } else {
                    $(this).find(".st0").css("fill", "white");
                    $(this).attr("filtered", "false");
                }
            });
        }

        function filterByTag(category, tag, isInKeywords=false) { console.log("#" + category + tag.replace(" ", "-"));
            var hide = $("#" + category + tag.replace(" ", "-")).attr("filtered") == "true";
            $('a.bubble-node').each(function() {
                var obj = $("#" + category + (isInKeywords ? tag.replace(" ", "-") : $(this).attr(category)));
                var foundTag = isInKeywords ? $(this).attr("keywords").split(";").includes(tag) : $(this).attr(category) == tag;
                if (isInKeywords) { console.log($(this).attr("keywords").split(";").includes(tag) );}
                if(foundTag && !hide) {
                    $(this).removeClass("hidden_" + category);
                    $("#label_" + $(this).attr("data-id").toString()).removeClass("hidden_" + category);
                    obj.attr("filtered", "true");
                    obj.addClass("selected");
                } else if ( ( !foundTag && obj.attr("filtered") != "true" )|| ( hide && foundTag ) ) {
                    obj.attr("filtered", "false");
                    obj.removeClass("selected");
                    var hideBubble = true;
                    if (isInKeywords) {
                        for (tagInCategory in tagsInCategories[category]) {
                            if ($("#" + category + tagsInCategories[category][tagInCategory].replace(" ", "-")).attr("filtered") == "true") {
                                hideBubble = false;
                            }
                        }
                    }
                    if (hideBubble) {
                        $(this).addClass("hidden_" + category);
                        $("#label_" + $(this).attr("data-id").toString()).addClass("hidden_" + category);
                    }
                }
            });
        }
    </script>
</head>

<body>
    <div id="edit-top-bar" class="container toolbar" style="display:none">
        <div style="position: fixed;z-index:1000000;opacity: 0.8;max-width: 960px;" class="row toolbar-header">
            <div class="col">
                EDIT MODE: You are editing the details of this dataset.
            </div>
            <div class="col">
                <img class="eyecon" onmouseup="toggleEdit()" style="height: 55%; padding-left:12%" id="cancel" src="assets/img/cancel.svg"> Cancel
            </div>
            <div class="col">
                <img class="eyecon" style="height: 55%; padding-left:12%" id="save" src="assets/img/save.svg"> Save
            </div>

        </div>
    </div>

    <div class="container">

        <div class="row">
            <div class="col header">
                <div style="display: flex; justify-content: center;">
                    <input class="searchInput" name="targetNode" type="text" />
                    <button class="button">Search</button>
                    <button class="reset">reset</button>
                    <div id="status"></div>
                </div>
                <div id="vis"></div>
            </div>
        </div>
    </div>
    <!-- begin conditional toolbar -->
    <div class="container toolbar">
        <div class="row toolbar-header">
            <div class="col dim_label" style="flex-grow:2;">
                <span class="dim_val">Title:</span>
                <span class="" id="title-input" contenteditable="false">
                </span>
            </div>
            <div class="col dim_label" style="flex-grow:1;">
                <span class="dim_val">Contact:</span> 
                <span id="contact-input" class="" contenteditable="false">
                Sample Email
                </span>
            </div>
            <div class="col dim_label" onmouseup="toggleEdit();" style="flex-grow:0.5;">
                <span class="">Edit</span> &nbsp; &nbsp;
                <span class="">New</span> 
            </div>
            <div class="col-auto">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-meta" collapsed="true" onmouseup="collapseToolbar('meta')"></i>
            </div>
        </div>
        <div class="row collapse" id="toolbar-meta">
            <div class="row">
                <div class="col-md-7 toolbar-items">
                    <div style="width:25%;">Description</div>
                    <div style="font-weight: 100" contentEditable="false" id="description-input">This dataset was created in 2012 to track the smoking habits of young adults over time</div>
                </div>
                <div class="col-md-4 toolbar-items">
                    <div>Keywords</div>
                    <div contentEditable="false" style="font-weight: 100" id="keywords-input">smoking, youngadults, 2012</div>
                </div>

            </div>
        </div>
    </div>
    <!-- begin first toolbar -->
    <div class="container toolbar">
        <div class="row toolbar-header">
            <div class="col dim_label" onmouseup="changeView('Coverage');">
                <img class="eyecon" id="eyeCoverage" collapsed="true" src="assets/img/icon/eye_hide.png"> Geo. Coverage
            </div>
            <div class="col dim_label" onmouseup="changeView('Population');">
                <img class="eyecon" collapsed="true" id="eyePopulation" src="assets/img/icon/eye_hide.png"> Population
            </div>
            <div class="col dim_label" onmouseup="changeView('Dataset');">
                <img class="eyecon" collapsed="false" id="eyeDataset" src="assets/img/icon/eye_show.png"> Type of Dataset
            </div>
            <div class="col dim_label" onmouseup="changeView('Level');" style="flex-grow:0.5;">
                <img class="eyecon" collapsed="true" id="eyeLevel" src="assets/img/icon/eye_hide.png"> Level
            </div>
            <div class="col-auto">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-top" collapsed="true" onmouseup="collapseToolbar('top')"></i>
            </div>
        </div>
        <div class="row collapse" id="toolbar-top">
            <div class="col">
                <span id="" class="geolevel toolbar-items">
                    <div style="float:left;"><img src="assets/img/icon/geo_1.png" class="icon"></div>
                    <div style="float:right;">
                        <div id="straat" class="item_geo">
                            <input type="checkbox" class="geolevelInput hidden radio" value="1" name="fooby[1][]" />
                            Straat<br>
                        </div>
                        <div id="buurt" class="item_geo">
                            <input type="checkbox" class="geolevelInput hidden radio" value="1" name="fooby[1][]" />
                            Buurt<br>
                        </div>
                        <div id="wijk" class="item_geo">
                            <input type="checkbox" class="geolevelInput hidden radio" value="1" name="fooby[1][]" />
                            Wijk<br>
                        </div>
                    </div>
                </span>
                <span id="" class="geolevel toolbar-items">
                    <div style="float:left;">
                        <img src="assets/img/icon/geo_2.png" class="icon" style="width:70px;height:70px;margin-right:-10px;margin-top:-10px">
                    </div>
                    <div style="float:right;">
                        <div id="gebied" class="item_geo">
                            Gebied<br>
                        </div>
                        <div id="stadsdeel" class="item_geo">
                            Stadsdeel<br>
                        </div>
                        <div id="stad" class="item_geo">
                            Stad
                        </div>
                    </div>
                </span>
                <span id="" class="geolevel toolbar-items">
                    <div style="float:left;"><img src="assets/img/icon/geo_3.png" class="icon"></div>
                    <div style="float:right;">
                        <div id="amstelland" class="item_geo">
                            Amstelland<br>
                        </div>
                        <div id="metroadam" class="item_geo">
                            Metro. A'dam<br>
                        </div>
                        <div id="g4" class="item_geo">
                            G4<br>
                        </div>
                        <div id="national" class="item_geo">
                            National
                        </div>
                    </div>  
                </span>
            </div>
            <div class="col" id="population" style="flex-grow:1.5;margin-left:20px">
                <div class="toolbar-items">
                    <div style="float:left;" id="populationYouth" class="item_population">
                        <img src="assets/img/youth.svg" class="icon">
                        <br>Youth
                    </div>
                    <div style="float:right;" id="populationYoung-Adult" class="item_population">
                        <img src="assets/img/young_adult.svg" class="icon">
                        <br>Young Adult
                    </div>
                </div>
                <div class="toolbar-items">
                    <div style="float:left;" id="populationAdult" class="item_population">
                        <img src="assets/img/adult.svg" class="icon">
                        <br>Adult
                    </div>
                    <div style="float:right;" id="populationElderly" class="item_population">
                        <img src="assets/img/old_person.svg" class="icon">
                        <br>Elderly
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="toolbar-items" style="display:block;margin-right:-50px;margin-top:-30px;" >
                    <svg style="transform:scale(0.6);margin-left:-90px;" height="300px" width="390px">
                       <g id="Layer_2" data-name="Layer 2">
                          <g id="Overview_rollover" data-name="Overview rollover">
                             <ellipse cx="196.92" cy="81.52" rx="8.74" ry="41.07" />
                             <ellipse cx="160.19" cy="108.38" rx="8.74" ry="41.07" transform="translate(7.61 227.24) rotate(-72)" />
                             <ellipse cx="174.33" cy="151.68" rx="41.07" ry="8.74" transform="translate(-50.86 203.56) rotate(-54)" />
                             <ellipse cx="219.71" cy="151.68" rx="8.74" ry="41.07" transform="matrix(0.81, -0.59, 0.59, 0.81, -47.2, 158.11)" />
                             <ellipse cx="233.86" cy="108.38" rx="41.07" ry="8.74" transform="translate(-22.05 77.57) rotate(-18)" />
                             <text transform="translate(100 25.95)">
                                <tspan>Questionnaire</tspan>
                             </text>
                             <text transform="translate(286.87 84.56)">
                                <tspan>Social</tspan>
                                <tspan x="0" y="30">Media</tspan>
                             </text>
                             <text transform="translate(258.9 183.13)">
                                <tspan>Health</tspan>
                                <tspan x="0" y="30">Promotion</tspan>
                             </text>
                             <text transform="translate(44.52 212.13)">
                                <tspan>Registry</tspan>
                             </text>
                             <text transform="translate(0 102.58)">
                                <tspan>Monitor</tspan>
                             </text>
                          </g>
                       </g>
                    </svg>
                </div>
            </div>
            <div class="col" style="flex-grow:0.5;">
                <div class="toolbar-items level">
                    <div style="float:left;">
                        <div class="item_level">
                            <img src="assets/img/icon/level_1_individual.png" class="icon">
                            <br>Individual
                        </div>
                        <div class="item_level">
                            <img src="assets/img/icon/level_2_family.png" class="icon">
                            <br>Family
                        </div>
                        <div class="item_level">
                            <img src="assets/img/icon/level_3_group.png" class="icon">
                            <br>Group
                        </div>
                    </div>
                    <div style="float:right;margin-left:10px">
                        <div class="item_level">
                            <img src="assets/img/icon/level_4_orga.png" class="icon">
                            <br>Organization
                        </div>
                        <div class="item_level">
                            <img src="assets/img/icon/level_5_geo.png" class="icon">
                            <br>Geography
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- begin second toolbar -->
    <div class="container toolbar">
        <div class="row toolbar-header">
            <div class="col dim_label" onmouseup="changeView('Cases','.bubble-label .bubble-label-value');" style="flex-grow:1.7;">
                <img class="eyecon" collapsed="false" id="eyeCases" src="assets/img/icon/eye_show.png"> Number of Cases
            </div>
            <div class="col dim_label" onmouseup="toggleFill();" style="flex-grow:1.4;">
                <img class="eyecon" id="eyeOwnership" collapsed="false" src="assets/img/icon/eye_show.png"> Ownership
            </div>
            <div class="col dim_label" onmouseup="changeView('Temporal','.arc');">
                <img class="eyecon" id="eyeTemporal" collapsed="false" src="assets/img/icon/eye_show.png"> Temporal Coverage
            </div>
            <div class="col-auto">
                <i class="fa fa-plus" aria-hidden="true" id="toolbar-icon-bottom" collapsed="true" onmouseup="collapseToolbar('bottom')"></i>
            </div>
        </div>
        <div class="row collapse" id="toolbar-bottom">
            <div class="col">
                <div id="caseGraph" style="display: block" class="toolbar-items">
                    <svg width="80%" version="1.1" id="Layer_1_Size" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 272.83 264.97"xml:space="preserve">
               <style type="text/css">
                   .st0{fill:#FFFFFF;stroke:#000000;stroke-miterlimit:10;cursor: pointer;}
                   .st1{font-family:'OpenSans';cursor: pointer;}
                   .st2{font-size:18px;margin-left:4px;}
               </style>
               <g class="size" data-size="more" id="size-more">
                   <circle class="st0" cx="138.54" cy="131.83" r="125"/>
                   <text transform="matrix(1 0 0 1 111.3019 36.1381)" class="st1 st2">More</text>
               </g>
               <g class="size" data-size="2000" id="size_2000">
                   <circle class="st0" cx="138.54" cy="158.6" r="100" />
                   <text transform="matrix(1 0 0 1 113.3809 87.7564)" class="st1 st2">2000</text>
               </g>
               <g class="size" data-size="1000" id="size_1000">
                   <circle class="st0" cx="138.54" cy="183.6" r="75" />
                   <text transform="matrix(1 0 0 1 113.381 139.375)" class="st1 st2">1000</text>
               </g>
               <g class="size" data-size="500" id="size_500">
                   <circle class="st0" cx="138.54" cy="208.6" r="50" />
                   <text transform="matrix(1 0 0 1 119.6702 188.9935)" class="st1 st2">500</text>
               </g>
               <g class="size" data-size="100" id="size_100">
                   <circle class="st0" cx="138.54" cy="226.83" r="30" />
                   <text transform="matrix(1 0 0 1 119.6704 234.6115)" class="st1 st2">100</text>
               </g>
               </svg>
                </div>
                <div id="caseInput" style="display: none" class="toolbar-items">
                    <span>
                        <form>
                            <label for="cases">Cases</label>
                            <input type="number" id="cases" name="age">
                        </form>
                    </span>
                    <span>
                        <form>
                            <label for="unit">Unit</label>
                            <input  id="unit" name="age">
                        </form>
                    </span>
                </div>
            </div>
            <div class="col">
                <div class="toolbar-items ownership">
                    <div style="float:left;">
                        <div id="departmentEGZ"><span style="background-color: purple;" class="circle"></span> EGZ</div>
                        <div id="departmentIZ"><span style="background-color: blue;" class="circle"></span> IZ</div>
                        <div id="departmentJGZ"><span style="background-color: green;" class="circle"></span> JGZ</div>
                        <div id="departmentVT"><span style="background-color: brown;" class="circle"></span> VT</div>
                        <div id="departmentMGZ"><span style="background-color: #ffc107;" class="circle"></span> MGZ</div>
                    </div>
                    <div style="float:right;">
                        <div id="departmentFGMA"><span style="background-color: red;" class="circle"></span> FGMA</div>
                        <div id="departmentGHOR"><span style="background-color: violet;" class="circle"></span> GHOR</div>
                        <div id="departmentLO"><span style="background-color: gray;" class="circle"></span> LO</div>
                        <div id="departmentAAGG"><span style="background-color: yellowgreen;" class="circle"></span> AAGG</div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="toolbar-items">
                    <img src="assets/img/time_widget.svg" width="100%">
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- D3 JS -->
    <script src="assets/js/libs/d3.min.js"></script>
    <script src="assets/js/libs/d3-scale.v3.min.js"></script>
    <script src="assets/js/libs/d3-path.v1.min.js"></script>
    <script src="assets/js/libs/d3-shape.v1.min.js"></script>

    <script defer src="assets/js/plugins.js"></script>
    <script src="assets/js/libs/coffee-script.js"></script>
    <script type="text/coffeescript" src="assets/coffee/vis.coffee"></script>

    <script type="text/javascript">
        //Number of Cases
        $(".size").each(function() {
            $(this).mouseover(function() {
                $(this).find(".st0").css("fill", "beige");
            });
            $(this).mouseout(function() {
                $(this).find(".st0").css("fill", $(this).attr("filtered") == "true" ? "yellow" : "white");
            });
            $(this).click(function() {
                showSize($(this).attr("data-size"));
            });
        });
        
        //Ownership/Department
        $("div.ownership div div").each(function() {
            $(this).click(function() {
                filterByTag("department", $(this).text().trim());  
            });
        });

        //Population
        tagsInCategories["population"] = [];
        $("#population div div").each(function() {
            var tag = $(this).text().trim();
            tagsInCategories["population"].push(tag);
            $(this).click(function() {
                filterByTag("population", tag, true);  
            });
        });
        console.log(tagsInCategories);
    </script>
</body>

</html>